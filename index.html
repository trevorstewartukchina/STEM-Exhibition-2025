<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <title>CLS Admissions | Master Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Outfit:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --cls-red: #ff3e3e; --neon-blue: #00f2ff; --neon-green: #39ff14; --glass: rgba(10, 15, 30, 0.98); --gold: #ffd700; }
        body, html { margin: 0; padding: 0; height: 100vh; width: 100%; font-family: 'Fredoka', sans-serif; background: #010208; color: white; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; z-index: -1; }

        /* REBUILT HEADER & SVG LOGO */
        .global-header { 
            position: fixed; top: 0; left: 0; width: 100%; height: 90px; 
            background: #000; border-bottom: 3px solid var(--cls-red);
            display: flex; align-items: center; justify-content: center; z-index: 10000;
        }
        .logo-box { display: flex; align-items: center; gap: 12px; }
        .cls-logo-svg { width: 55px; height: 55px; filter: drop-shadow(0 0 10px var(--cls-red)); }

        .app-container { display: flex; height: 100vh; padding-top: 90px; box-sizing: border-box; }
        
        /* STUDENT INTERFACE */
        .student-stage { flex: 2; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border-right: 2px solid var(--neon-blue); }
        .slide { display: none; width: 95%; text-align: center; }
        .slide.active { display: block; }
        
        .pilot-label { background: var(--neon-green); color: black; padding: 5px 15px; border-radius: 20px; font-weight: 900; margin-bottom: 20px; display: inline-block; font-size: 0.8rem; text-transform: uppercase; }
        .logic-box { background: rgba(0,0,0,0.8); padding: 25px; border-radius: 30px; border: 2px dashed var(--neon-blue); width: 100%; max-width: 550px; margin: 0 auto; position: relative; }

        /* BALLOON SYSTEM */
        .balloon-pit { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; min-height: 120px; align-items: flex-end; }
        .balloon { 
            width: 50px; height: 65px; border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
            cursor: pointer; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.2s; position: relative;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.3);
        }
        .balloon:active { transform: scale(0); opacity: 0; pointer-events: none; }

        /* TEACHER HUD - UNIQUE BUTTONS */
        .teacher-hud { flex: 1.3; background: var(--glass); padding: 10px; overflow-y: auto; border-left: 1px solid #333; }
        .hud-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .student-card { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 10px; border-top: 4px solid #444; text-align: center; }
        .phase-block { margin-top: 10px; border-top: 1px solid #222; padding-top: 5px; }
        .phase-name { font-size: 0.55rem; color: var(--neon-blue); font-weight: 900; text-transform: uppercase; }
        
        .btn-pair { display: flex; gap: 2px; margin-top: 3px; }
        .score-btn { flex: 1; font-size: 0.5rem; padding: 6px 0; border: none; cursor: pointer; background: #222; color: #555; font-weight: 900; border-radius: 4px; }
        .score-btn.yes.active { background: var(--neon-green) !important; color: #000 !important; box-shadow: 0 0 10px var(--neon-green); }
        .score-btn.no.active { background: var(--cls-red) !important; color: #fff !important; box-shadow: 0 0 10px var(--cls-red); }

        .btn-action { padding: 15px 30px; border-radius: 40px; border: none; font-weight: 900; cursor: pointer; background: var(--neon-blue); color: black; margin-top: 20px; }

        @media print {
            .teacher-hud, .btn-action, #canvas, .pilot-label { display: none !important; }
            body { background: white !important; color: black !important; overflow: visible !important; }
            .global-header { position: relative !important; border-bottom: 4px solid black !important; background: white !important; }
            .app-container { padding-top: 0 !important; display: block !important; }
            .slide { display: block !important; page-break-after: always; }
        }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>
<audio id="spaceMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" type="audio/mpeg"></audio>

<div class="global-header">
    <div class="logo-box">
        <svg class="cls-logo-svg" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="#ff3e3e" stroke="white" stroke-width="4"/>
            <text x="50" y="65" text-anchor="middle" fill="white" font-family="Outfit" font-weight="900" font-size="35">CLS</text>
        </svg>
        <div style="font-family:'Outfit'; font-size: 1.5rem; letter-spacing: 2px;">ADMISSIONS</div>
    </div>
</div>

<div class="app-container">
    <div class="student-stage">
        <div id="s0" class="slide active">
            <h1 style="font-family:'Outfit'; font-size: 2.5rem;">ADMISSIONS ENGINE</h1>
            <p>Register Pilots (separate with commas):</p>
            <input type="text" id="namesIn" value="Child 1, Child 2, Child 3, Child 4, Child 5" style="width: 320px; padding: 15px; background: #111; color: white; border: 1px solid var(--neon-blue); text-align: center; border-radius: 12px; font-size: 1rem;">
            <br><button class="btn-action" onclick="launch()">ENGAGE ENGINES üöÄ</button>
        </div>

        <div id="s1" class="slide"><div class="pilot-label" id="L1"></div><div class="logic-box"><h2 id="Q1" style="font-size: 2.2rem;"></h2></div><button class="btn-action" style="background:#fff;" onclick="cycle(1)">NEXT QUESTION ‚ûî</button></div>
        <div id="s2" class="slide"><div class="pilot-label" id="L2"></div><div id="G2" style="display:grid; grid-template-columns: repeat(6, 1fr); gap: 10px;"></div><button class="btn-action" style="background:#fff;" onclick="cycle(2)">REFRESH ‚ûî</button></div>
        
        <div id="s3" class="slide">
            <div class="pilot-label" id="L3">Pilot</div>
            <h2 id="targetHeading" style="margin-bottom:15px; font-size: 2.5rem; color: var(--neon-blue);">Find the Aa's!</h2>
            <div id="letterGrid" style="display:grid; grid-template-columns: repeat(6, 1fr); gap: 10px; background:rgba(255,255,255,0.05); padding:20px; border-radius:20px;"></div>
            <button class="btn-action" style="background:#fff;" onclick="cycle(3)">NEW TARGET ‚ûî</button>
        </div>

        <div id="s4" class="slide"><div class="pilot-label" id="L4"></div><div class="logic-box"><h1 id="Q4" style="font-size:5rem;"></h1><p>What comes next?</p></div><button class="btn-action" style="background:#fff;" onclick="cycle(4)">NEXT ‚ûî</button></div>

        <div id="s5" class="slide">
            <div class="pilot-label" id="L5">Pilot</div>
            <div class="logic-box">
                <div class="balloon-pit" id="balloonPit"></div>
                <h2 id="colorTask" style="color:var(--neon-blue); font-size: 2rem;">"Pop the Red Balloon!"</h2>
            </div>
            <button class="btn-action" style="background:#fff;" onclick="cycle(5)">NEXT COLOR ‚ûî</button>
        </div>
        
        <div id="s6" class="slide">
            <h1 style="font-family:'Outfit'; color:var(--neon-green);">ASSESSMENT COMPLETE</h1>
            <button class="btn-action" onclick="window.print()" style="background:#fff; color:#000;">PRINT REPORT üñ®Ô∏è</button>
            <div id="finalReport" style="margin-top:20px;"></div>
        </div>

        <div id="nav" style="display:none; margin-top: 25px;">
            <button class="btn-action" style="background:#222; color:#fff;" onclick="move(-1)">PREVIOUS</button>
            <button class="btn-action" onclick="move(1)">NEXT PHASE</button>
        </div>
    </div>

    <div class="teacher-hud">
        <h3 style="text-align:center; color:var(--cls-red); font-size:0.8rem;">TEACHER COMMAND HUB</h3>
        <div class="hud-grid" id="hudGrid"></div>
    </div>
</div>

<script>
    let pilots = [], cur = 0, scores = [{},{},{},{},{}], subIdx = [0,0,0,0,0,0];
    const comms = ["What's your name?", "How old are you?", "How are you today?", "Favorite animal?", "Favorite toy?"];
    const targets = ["Aa", "Bb", "Mm", "Ss", "Cc"];
    const colors = ["Red", "Blue", "Green", "Yellow", "Pink", "Purple", "Orange"];
    const logic = ["1 2 3 ?", "A B A ?", "üçé üçå üçé ?", "2 4 6 ?", "üî¥ üîµ üî¥ ?"];

    function launch() {
        pilots = document.getElementById('namesIn').value.split(',').map(n => n.trim());
        document.getElementById('spaceMusic').play();
        document.getElementById('nav').style.display = 'block';
        renderHud(); refreshUI(); move(1);
    }

    function renderHud() {
        const keys = ['c','p','v','l','k'], tags = ['Comms', 'Phonics', 'Visual', 'Logic', 'Colours'];
        document.getElementById('hudGrid').innerHTML = pilots.slice(0,5).map((p, sIdx) => `
            <div class="student-card">
                <div style="font-size: 0.6rem; font-weight:900; color:var(--neon-blue);">${p}</div>
                <div id="p${sIdx}" style="font-size: 1rem; color:var(--gold); font-weight:900;">0%</div>
                ${keys.map((k, i) => `
                    <div class="phase-block">
                        <div class="phase-name">${tags[i]}</div>
                        <div class="btn-pair">
                            <button id="y-${sIdx}-${k}" class="score-btn yes" onclick="setScore(${sIdx},'${k}',true)">YES</button>
                            <button id="n-${sIdx}-${k}" class="score-btn no" onclick="setScore(${sIdx},'${k}',false)">NO</button>
                        </div>
                    </div>
                `).join('')}
            </div>
        `).join('');
    }

    function setScore(sIdx, ph, val) {
        scores[sIdx][ph] = val;
        document.getElementById(`y-${sIdx}-${ph}`).classList.remove('active');
        document.getElementById(`n-${sIdx}-${ph}`).classList.remove('active');
        document.getElementById(`${val?'y':'n'}-${sIdx}-${ph}`).classList.add('active');
        let count = 0; ['c','p','v','l','k'].forEach(k => { if(scores[sIdx][k] === true) count++; });
        document.getElementById(`p${sIdx}`).innerText = (count * 20) + "%";
    }

    function move(d) {
        document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
        cur += d;
        if(document.getElementById('s'+cur)) document.getElementById('s'+cur).classList.add('active');
        if(cur === 6) showFinal();
    }

    function cycle(p) { subIdx[p] = (subIdx[p]+1)%5; refreshUI(); }

    function refreshUI() {
        document.getElementById('L1').innerText = pilots[subIdx[1]]; document.getElementById('Q1').innerText = `"${comms[subIdx[1]]}"`;
        document.getElementById('L2').innerText = pilots[subIdx[2]]; document.getElementById('G2').innerHTML = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('').sort(()=>.5-Math.random()).slice(0,18).map(l => `<div style="background:white; color:black; padding:12px; font-weight:bold; border-radius:8px;">${l}</div>`).join('');
        
        // Phonics Fix
        const t = targets[subIdx[3]];
        document.getElementById('L3').innerText = pilots[subIdx[3]];
        document.getElementById('targetHeading').innerText = `Find the ${t}'s!`;
        document.getElementById('letterGrid').innerHTML = Array(24).fill(0).map(()=>`<div style="background:white; color:black; padding:10px; border-radius:8px; font-weight:bold;">${targets[Math.floor(Math.random()*5)]}</div>`).join('');
        
        document.getElementById('L4').innerText = pilots[subIdx[4]]; document.getElementById('Q4').innerText = logic[subIdx[4]];
        
        // Balloons Fix
        document.getElementById('L5').innerText = pilots[subIdx[5]];
        const tCol = colors[subIdx[5]];
        document.getElementById('colorTask').innerText = `"Pop the ${tCol} balloon!"`;
        document.getElementById('balloonPit').innerHTML = colors.map(c => `<div class="balloon" style="background:${c.toLowerCase()}" onclick="this.style.transform='scale(0)';"></div>`).sort(()=>.5-Math.random()).join('');
    }

    function showFinal() {
        document.getElementById('finalReport').innerHTML = pilots.slice(0,5).map((p, i) => {
            let count = 0; ['c','p','v','l','k'].forEach(k => { if(scores[i][k] === true) count++; });
            return `<div style="padding:15px; border:2px solid black; margin-bottom:8px; display:flex; justify-content:space-between; background:white; color:black; border-radius:10px;"><b>${p.toUpperCase()}</b> <span>SCORE: ${count*20}%</span></div>`;
        }).join('');
    }

    const canvas = document.getElementById('canvas'); const ctx = canvas.getContext('2d');
    let stars = []; function res() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = res; res();
    for(let i=0; i<80; i++) stars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*2});
    function draw() {
        ctx.clearRect(0,0,canvas.width, canvas.height); ctx.fillStyle="white";
        stars.forEach(s => { ctx.beginPath(); ctx.arc(s.x, s.y, s.s, 0, Math.PI*2); ctx.fill(); s.y+=0.1; if(s.y>canvas.height) s.y=0; });
        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>
